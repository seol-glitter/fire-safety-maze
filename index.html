<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>화재 대피 미로 게임</title>
<style>
  body { margin:0; text-align:center; background:#eee; }
  #controls { padding:10px; }
  button { margin:5px; padding:10px 20px; font-size:1em; }
  #gameArea { 
    position:relative; 
    width:100vw; height:80vh; 
    background:white; 
    border:3px solid black; 
    touch-action:none;
    overflow:hidden;
    margin:auto;
  }
  .wall { position:absolute; background:lightcoral; }
  #player { 
    position:absolute; 
    width:6vw; height:6vw; 
    background:url("running.png") no-repeat center/contain; 
    top:2vh; left:2vw;
  }
  #exit { 
    position:absolute; 
    width:8vw; height:8vw; 
    background:url("exit.png") no-repeat center/contain; 
    bottom:4vh; right:4vw;
  }
  .fire {
    position:absolute; 
    width:6vw; height:6vw;
    background:url("fire.png") no-repeat center/contain;
  }
</style>
</head>
<body>
<h2>🔥 화재 대피 미로 게임</h2>
<div id="controls">
  <button onclick="loadLevel(1)">레벨 1</button>
  <button onclick="loadLevel(2)">레벨 2</button>
  <button onclick="loadLevel(3)">레벨 3</button>
</div>
<div id="gameArea">
  <div id="player"></div>
  <div id="exit"></div>
</div>

<script>
const gameArea = document.getElementById("gameArea");
const player = document.getElementById("player");
const exit = document.getElementById("exit");
let walls = [];
let fires = [];
let dragging = false, offsetX, offsetY;
let x = gameArea.clientWidth*0.02, y = gameArea.clientHeight*0.02;

// 레벨별 미로 구조 정의
const levels = {
  1: {
    walls: [
      {top:"20vh", left:"0", width:"80vw", height:"3vh"},
      {top:"50vh", left:"20vw", width:"80vw", height:"3vh"},
    ],
    fires: [
      {top:"18vh", left:"60vw"},
    ]
  },
  2: {
    walls: [
      {top:"15vh", left:"0", width:"70vw", height:"3vh"},
      {top:"30vh", left:"30vw", width:"70vw", height:"3vh"},
      {top:"50vh", left:"0", width:"90vw", height:"3vh"},
      {top:"65vh", left:"40vw", width:"60vw", height:"3vh"},
    ],
    fires: [
      {top:"25vh", left:"15vw"},
      {top:"60vh", left:"70vw"},
    ]
  },
  3: {
    walls: [
      {top:"10vh", left:"20vw", width:"60vw", height:"3vh"},
      {top:"25vh", left:"0", width:"70vw", height:"3vh"},
      {top:"40vh", left:"30vw", width:"70vw", height:"3vh"},
      {top:"55vh", left:"10vw", width:"80vw", height:"3vh"},
      {top:"70vh", left:"50vw", width:"50vw", height:"3vh"},
    ],
    fires: [
      {top:"20vh", left:"10vw"},
      {top:"38vh", left:"60vw"},
      {top:"68vh", left:"80vw"},
    ]
  }
};

// 레벨 로드 함수
function loadLevel(num) {
  // 기존 벽/불꽃 제거
  walls.forEach(w => w.remove());
  fires.forEach(f => f.remove());
  walls = [];
  fires = [];

  // 레벨 불러오기
  const level = levels[num];
  level.walls.forEach(data=>{
    const w = document.createElement("div");
    w.className="wall";
    Object.assign(w.style, data);
    gameArea.appendChild(w);
    walls.push(w);
  });
  level.fires.forEach(data=>{
    const f = document.createElement("div");
    f.className="fire";
    Object.assign(f.style, data, {width:"6vw", height:"6vw"});
    gameArea.appendChild(f);
    fires.push(f);
  });

  // 플레이어 시작 위치 초기화
  x = gameArea.clientWidth*0.02; 
  y = gameArea.clientHeight*0.02;
  player.style.left = x + "px";
  player.style.top = y + "px";
}

function canMove(newX, newY) {
  player.style.left = newX + "px";
  player.style.top = newY + "px";
  const pRect = player.getBoundingClientRect();
  for (const wall of walls) {
    const wRect = wall.getBoundingClientRect();
    if (!(pRect.right <= wRect.left || pRect.left >= wRect.right ||
          pRect.bottom <= wRect.top || pRect.top >= wRect.bottom)) {
      return false;
    }
  }
  return true;
}

function movePlayer(newX, newY) {
  const areaRect = gameArea.getBoundingClientRect();
  newX = Math.max(0, Math.min(newX, areaRect.width - player.clientWidth));
  newY = Math.max(0, Math.min(newY, areaRect.height - player.clientHeight));

  if (canMove(newX, newY)) {
    x = newX; y = newY;
    player.style.left = x + "px";
    player.style.top = y + "px";

    const pRect = player.getBoundingClientRect();
    const eRect = exit.getBoundingClientRect();
    if (!(pRect.right < eRect.left || pRect.left > eRect.right ||
          pRect.bottom < eRect.top || pRect.top > eRect.bottom)) {
      alert("성공! 레벨 클리어 🎉");
    }
  } else {
    player.style.left = x + "px";
    player.style.top = y + "px";
  }
}

// 마우스 드래그
player.addEventListener("mousedown", e => {
  dragging = true;
  offsetX = e.clientX - player.offsetLeft;
  offsetY = e.clientY - player.offsetTop;
});
document.addEventListener("mousemove", e => {
  if (!dragging) return;
  movePlayer(e.clientX - offsetX, e.clientY - offsetY);
});
document.addEventListener("mouseup", () => dragging = false);

// 터치 드래그
player.addEventListener("touchstart", e => {
  dragging = true;
  offsetX = e.touches[0].clientX - player.offsetLeft;
  offsetY = e.touches[0].clientY - player.offsetTop;
});
document.addEventListener("touchmove", e => {
  if (!dragging) return;
  movePlayer(e.touches[0].clientX - offsetX, e.touches[0].clientY - offsetY);
});
document.addEventListener("touchend", () => dragging = false);

// 기본 레벨1 시작
loadLevel(1);
</script>
</body>
</html>
