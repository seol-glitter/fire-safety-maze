<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>화재 대피 미로 게임</title>
<style>
  body { margin:0; background:#000; display:flex; justify-content:center; align-items:center; height:100vh; }
  #container { position:relative; }
  #gameCanvas {
    display:block;
    max-width:100vw;
    max-height:100vh;
    width:auto;
    height:auto;
  }
  #player, #exit {
    position:absolute;
    background-size:contain;
    background-repeat:no-repeat;
    transform:translate(-50%, -50%);
  }
  /* 캐릭터와 출구 크기를 기존 대비 1.8배 확대 */
  #player { width:10.8%; height:10.8%; background-image:url("running.png"); }
  #exit   { width:14.4%; height:14.4%; background-image:url("exit.png"); }
</style>
</head>
<body>
<div id="container">
  <canvas id="gameCanvas" width="902" height="487"></canvas>
  <div id="player"></div>
  <div id="exit"></div>
</div>

<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");
const mazeImg = new Image();
mazeImg.src = "maze.jpg";

const player = document.getElementById("player");
const exit = document.getElementById("exit");

const ORIGINAL_WIDTH = 902;
const ORIGINAL_HEIGHT = 487;

let dragging = false;
let x = 50, y = 50;

mazeImg.onload = () => {
  ctx.drawImage(mazeImg, 0, 0, ORIGINAL_WIDTH, ORIGINAL_HEIGHT);
  updatePositions();
};

function updatePositions() {
  const rect = canvas.getBoundingClientRect();
  const scaleX = rect.width / ORIGINAL_WIDTH;
  const scaleY = rect.height / ORIGINAL_HEIGHT;

  // 플레이어 위치
  player.style.left = rect.left + x * scaleX + "px";
  player.style.top  = rect.top  + y * scaleY + "px";

  // 출구 위치 (원본 비율 기준)
  const exitX = 820, exitY = 420;
  exit.style.left = rect.left + exitX * scaleX + "px";
  exit.style.top  = rect.top  + exitY * scaleY + "px";
}

function canMove(newX, newY) {
  const pixel = ctx.getImageData(newX + 25, newY + 25, 1, 1).data;
  return (pixel[0] > 240 && pixel[1] > 240 && pixel[2] > 240);
}

function movePlayer(clientX, clientY) {
  const rect = canvas.getBoundingClientRect();
  const scaleX = ORIGINAL_WIDTH / rect.width;
  const scaleY = ORIGINAL_HEIGHT / rect.height;

  const newX = (clientX - rect.left) * scaleX - 25;
  const newY = (clientY - rect.top) * scaleY - 25;

  if (newX >= 0 && newY >= 0 && newX <= ORIGINAL_WIDTH - 50 && newY <= ORIGINAL_HEIGHT - 50) {
    if (canMove(newX, newY)) {
      x = newX; y = newY;
      updatePositions();

      const pRect = player.getBoundingClientRect();
      const eRect = exit.getBoundingClientRect();
      if (!(pRect.right < eRect.left || pRect.left > eRect.right ||
            pRect.bottom < eRect.top || pRect.top > eRect.bottom)) {
        alert("성공! 안전하게 도착했어요!");
      }
    }
  }
}

// 마우스 조작
player.addEventListener("mousedown", e => { dragging = true; });
document.addEventListener("mousemove", e => { if(dragging) movePlayer(e.clientX, e.clientY); });
document.addEventListener("mouseup", ()=> dragging=false);

// 터치 조작
player.addEventListener("touchstart", e => { dragging=true; });
document.addEventListener("touchmove", e => { if(dragging) movePlayer(e.touches[0].clientX, e.touches[0].clientY); });
document.addEventListener("touchend", ()=> dragging=false);

window.addEventListener("resize", updatePositions);
</script>
</body>
</html>
