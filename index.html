<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>화재 대피 미로 게임</title>
<style>
  body { display:flex; justify-content:center; align-items:center; height:100vh; background:#eee; margin:0; }
  #gameArea { position:relative; width:500px; height:500px; background:white; border:3px solid black; touch-action:none; }
  .wall { position:absolute; background:gray; }
  /* 플레이어를 running.png 이미지로 설정 */
  #player { 
    position:absolute; width:50px; height:50px; 
    background:url("running.png") no-repeat center/contain; 
    top:10px; left:10px;
  }
  /* 출구를 exit.png 이미지로 설정 */
  #exit { 
    position:absolute; width:60px; height:60px; 
    background:url("exit.png") no-repeat center/contain; 
    bottom:10px; right:10px;
  }
</style>
</head>
<body>
<div id="gameArea">
  <div id="player"></div>
  <div id="exit"></div>
  <!-- 벽들 -->
  <div class="wall" style="top:100px; left:0; width:400px; height:20px;"></div>
  <div class="wall" style="top:200px; left:100px; width:20px; height:250px;"></div>
  <div class="wall" style="top:300px; left:200px; width:300px; height:20px;"></div>
</div>

<script>
const player = document.getElementById("player");
const exit = document.getElementById("exit");
const walls = document.querySelectorAll(".wall");
const gameArea = document.getElementById("gameArea");

let dragging = false, offsetX, offsetY;
let x = 10, y = 10; // 현재 위치

function canMove(newX, newY) {
  player.style.left = newX + "px";
  player.style.top = newY + "px";
  const pRect = player.getBoundingClientRect();

  for (const wall of walls) {
    const wRect = wall.getBoundingClientRect();
    if (!(pRect.right <= wRect.left || pRect.left >= wRect.right ||
          pRect.bottom <= wRect.top || pRect.top >= wRect.bottom)) {
      return false; // 벽 충돌 → 이동 불가
    }
  }
  return true;
}

function movePlayer(newX, newY) {
  const areaRect = gameArea.getBoundingClientRect();
  newX = Math.max(0, Math.min(newX, areaRect.width - player.clientWidth));
  newY = Math.max(0, Math.min(newY, areaRect.height - player.clientHeight));

  if (canMove(newX, newY)) {
    x = newX; y = newY;
    player.style.left = x + "px";
    player.style.top = y + "px";

    const pRect = player.getBoundingClientRect();
    const eRect = exit.getBoundingClientRect();
    if (!(pRect.right < eRect.left || pRect.left > eRect.right ||
          pRect.bottom < eRect.top || pRect.top > eRect.bottom)) {
      alert("성공! 안전하게 도착했어요!");
    }
  } else {
    player.style.left = x + "px";
    player.style.top = y + "px";
  }
}

// PC 마우스 드래그
player.addEventListener("mousedown", e => {
  dragging = true;
  offsetX = e.clientX - player.offsetLeft;
  offsetY = e.clientY - player.offsetTop;
});
document.addEventListener("mousemove", e => {
  if (!dragging) return;
  movePlayer(e.clientX - offsetX, e.clientY - offsetY);
});
document.addEventListener("mouseup", () => dragging = false);

// 모바일 터치 드래그
player.addEventListener("touchstart", e => {
  dragging = true;
  offsetX = e.touches[0].clientX - player.offsetLeft;
  offsetY = e.touches[0].clientY - player.offsetTop;
});
document.addEventListener("touchmove", e => {
  if (!dragging) return;
  movePlayer(e.touches[0].clientX - offsetX, e.touches[0].clientY - offsetY);
});
document.addEventListener("touchend", () => dragging = false);
</script>
</body>
</html>
